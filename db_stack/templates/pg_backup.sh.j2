#!/bin/bash
BACKUP_DIR={{ backup_dir }}
DB_NAME={{ db_name }}
DB_USER={{ db_user }}
DB_PASSWORD={{ postgres_pass }}
DATE=$(date +%Y-%m-%d)
BACKUP_FILE=$BACKUP_DIR/$DB_NAME-$DATE.sql

mkdir -p $BACKUP_DIR
PGPASSWORD=$DB_PASSWORD pg_dump -U $DB_USER -h 127.0.0.1 -p 5432 $DB_NAME > $BACKUP_FILE

# Rotation
find $BACKUP_DIR -type f -name "*.sql" -mtime +{{ backup_rotation_days }} -delete
